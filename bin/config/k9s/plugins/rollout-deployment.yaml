# Rollout all deployments except the selected one
shortCut: Shift-R
description: Rollout all except selected
dangerous: true
scopes:
  - deployments
command: bash
background: false
args:
    - -c
    - |
      GREEN='\033[0;32m'
      RED='\033[0;31m'
      YELLOW='\033[1;33m'
      BLUE='\033[0;34m'
      NC='\033[0m'

      clear
      echo -e "${YELLOW}╔════════════════════════════════════════════════════════════════╗${NC}"
      echo -e "${YELLOW}║       Rollout All Deployments (Except Selected)               ║${NC}"
      echo -e "${YELLOW}╚════════════════════════════════════════════════════════════════╝${NC}"
      echo ""
      echo -e "${BLUE}Namespace:${NC}        $NAMESPACE"
      echo -e "${BLUE}Context:${NC}          $CONTEXT"
      echo -e "${BLUE}Excluded Deploy:${NC} $NAME"
      echo ""
      echo -e "${YELLOW}Getting all deployments in namespace...${NC}"
      echo ""

      # Get all deployments except the selected one
      DEPLOYMENTS=$(kubectl --context=$CONTEXT -n=$NAMESPACE get deployments -o jsonpath='{.items[*].metadata.name}')
      
      FAILED=0
      SUCCESS=0
      SKIPPED=0

      for DEPLOY in $DEPLOYMENTS; do
        if [ "$DEPLOY" == "$NAME" ]; then
          echo -e "${YELLOW}⊘ Skipping:${NC} deployment/$DEPLOY (selected)"
          SKIPPED=$((SKIPPED + 1))
        else
          kubectl --context=$CONTEXT -n=$NAMESPACE rollout restart deployment/$DEPLOY &>/dev/null
          if [ $? -eq 0 ]; then
            echo -e "${GREEN}✓ Restarted:${NC} deployment/$DEPLOY"
            SUCCESS=$((SUCCESS + 1))
          else
            echo -e "${RED}✗ Failed:${NC} deployment/$DEPLOY"
            FAILED=$((FAILED + 1))
          fi
        fi
      done

      echo ""
      echo -e "${YELLOW}════════════════════════════════════════════════════════════════${NC}"
      echo -e "${GREEN}Success: $SUCCESS${NC} | ${RED}Failed: $FAILED${NC} | ${YELLOW}Skipped: $SKIPPED${NC}"
      echo -e "${YELLOW}════════════════════════════════════════════════════════════════${NC}"
      echo ""
      read -n 1 -s -r -p "Press any key to exit..."
